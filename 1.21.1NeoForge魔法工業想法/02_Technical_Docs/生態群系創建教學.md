# 🌍 Koniavacraft 新增生物群系完整攻略

## 🎯 概覽

基於你優化過的生物群系系統，添加新生物群系現在變得**非常簡單**！整個流程只需要修改 4 個地方。

---

## 📋 新增流程總覽

```
1️⃣ 在 ModBiomes.java 定義生物群系
2️⃣ 在 UniversalBiomeRegistration.java 註冊氣候
3️⃣ 在 CompleteBiomeSurfaceSystem.java 添加處理器
4️⃣ 創建數據包註冊（如果需要）
```

---

## 🔥 實戰範例：創建「火山灰原」生物群系

讓我們一步步創建一個新的「火山灰原」生物群系：

### 🔸 第一步：定義生物群系 (ModBiomes.java)

在 `ModBiomes.java` 中添加：

```java
// === 在現有的 ResourceKey 定義區域添加 ===
public static final ResourceKey<Biome> VOLCANIC_ASHLANDS = ResourceKey.create(
    Registries.BIOME,
    ResourceLocation.fromNamespaceAndPath(KoniavacraftMod.MOD_ID, "volcanic_ashlands")
);

// === 在文件末尾添加創建方法 ===
/**
 * 創建火山灰原生物群系
 */
public static Biome createVolcanicAshlands(HolderGetter<PlacedFeature> placedFeatures,
                                          HolderGetter<ConfiguredWorldCarver<?>> carvers) {
    KoniavacraftMod.LOGGER.info("🌋 正在創建火山灰原生物群系...");

    BiomeGenerationSettings.Builder generationSettings = 
        new BiomeGenerationSettings.Builder(placedFeatures, carvers);
    MobSpawnSettings.Builder mobSpawnSettings = new MobSpawnSettings.Builder();

    // 🔥 添加基礎特徵
    try {
        BiomeDefaultFeatures.addDefaultMonsterRoom(generationSettings);
        BiomeDefaultFeatures.addDefaultOres(generationSettings);
        // 火山地區，不要草地特徵
    } catch (Exception e) {
        KoniavacraftMod.LOGGER.warn("跳過特徵以避免循環衝突");
    }

    // 🔥 稀少的生物生成（惡劣環境）
    mobSpawnSettings.addSpawn(MobCategory.MONSTER,
        new MobSpawnSettings.SpawnerData(EntityType.MAGMA_CUBE, 4, 2, 4));
    mobSpawnSettings.addSpawn(MobCategory.MONSTER,
        new MobSpawnSettings.SpawnerData(EntityType.BLAZE, 2, 1, 2));
    
    return new Biome.BiomeBuilder()
        .temperature(1.5f)                    // 🔥 很熱
        .downfall(0.1f)                       // 🏜️ 很乾燥
        .hasPrecipitation(false)              // ❌ 不下雨
        .temperatureAdjustment(Biome.TemperatureModifier.NONE)
        .specialEffects(createVolcanicAshlandsEffects())
        .mobSpawnSettings(mobSpawnSettings.build())
        .generationSettings(generationSettings.build())
        .build();
}

/**
 * 火山灰原視覺效果
 */
private static BiomeSpecialEffects createVolcanicAshlandsEffects() {
    return new BiomeSpecialEffects.Builder()
        .waterColor(0x8B4513)           // 🟤 褐色水（被灰塵污染）
        .waterFogColor(0x654321)        // 🟫 深褐色水霧
        .skyColor(0xD2691E)             // 🧡 橙褐色天空
        .fogColor(0x696969)             // 🌫️ 灰色霧氣
        .grassColorOverride(0x8B7D6B)   // 🟫 枯黃的草
        .foliageColorOverride(0x8B7355) // 🍂 褐色植被
        .ambientMoodSound(AmbientMoodSettings.LEGACY_CAVE_SETTINGS)
        .build();
}
```

### 🔸 第二步：註冊氣候配置 (UniversalBiomeRegistration.java)

在 `registerAllBiomes()` 方法中添加：

```java
private static void registerAllBiomes() {
    // ... 現有的魔力草原註冊 ...

    // 🔥 火山灰原 - 稀有的極端環境
    UniversalBiomeInjector.registerBiome(
        ModBiomes.VOLCANIC_ASHLANDS,
        UniversalBiomeInjector.ClimateConfig.builder()
            .temperature(1.0F, 1.8F)         // 🔥 極熱
            .humidity(-0.8F, 0.1F)           // 🏜️ 極乾燥
            .continentalness(0.3F, 0.8F)     // 🏔️ 內陸
            .erosion(0.2F, 0.7F)             // 🌋 高侵蝕（火山活動）
            .depth(-0.1F, 0.4F)              // 🏔️ 平地到小山
            .weirdness(0.4F, 1.2F)           // 🌀 高怪異度（稀有）
            .build(),
        3, // 低權重，稀有生物群系
        "被火山灰覆蓋的荒涼原野"
    );

    KoniavacraftMod.LOGGER.info("📝 生物群落註冊完成！");
}
```

### 🔸 第三步：添加地表處理器 (CompleteBiomeSurfaceSystem.java)

#### 3.1 創建處理器類

在 `CompleteBiomeSurfaceSystem.java` 中添加新的處理器：

```java
/**
 * 🔥 火山灰原處理器
 */
public static class VolcanicAshlandsBiomeProcessor implements BiomeProcessor {
    @Override
    public boolean canProcess(ServerLevel level, ChunkAccess chunk) {
        return BlockReplacementUtils.isBiomeFast(level, chunk, ModBiomes.VOLCANIC_ASHLANDS);
    }

    @Override
    public int processChunk(ServerLevel level, ChunkAccess chunk) {
        return BlockReplacementUtils.replace(level, chunk, ModBiomes.VOLCANIC_ASHLANDS,
            BlockReplacementUtils.rules(
                Blocks.GRASS_BLOCK, Blocks.COARSE_DIRT,  // 草地 → 粗泥
                Blocks.DIRT, Blocks.COARSE_DIRT,         // 泥土 → 粗泥
                Blocks.STONE, Blocks.BASALT,             // 石頭 → 玄武岩
                Blocks.WATER, Blocks.LAVA                // 水 → 岩漿！
            ),
            BlockReplacementUtils.conditions(
                Blocks.SAND, BlockReplacementUtils.chance(0.3f) // 30%機率替換沙子
            )
        );
    }
}
```

#### 3.2 註冊處理器

在 `static {}` 區塊中註冊：

```java
static {
    // 🌱 現有的魔力草原處理器
    registerBiomeProcessor(ModBiomes.MANA_PLAINS, new ManaPlainsBiomeProcessor());
    
    // 🔥 新增：火山灰原處理器
    registerBiomeProcessor(ModBiomes.VOLCANIC_ASHLANDS, new VolcanicAshlandsBiomeProcessor());
}
```

### 🔸 第四步：數據包註冊

如果你有數據生成器，在你的 `ModBiomeProvider` 中添加：

```java
// 在 RegistrySetBuilder 中添加
.add(Registries.BIOME, bootstrap -> {
    HolderGetter<PlacedFeature> placedFeatures = bootstrap.lookup(Registries.PLACED_FEATURE);
    HolderGetter<ConfiguredWorldCarver<?>> carvers = bootstrap.lookup(Registries.CONFIGURED_CARVER);
    
    // 現有的魔力草原
    bootstrap.register(ModBiomes.MANA_PLAINS, 
        ModBiomes.createManaPlains(placedFeatures, carvers));
    
    // 🔥 新增：火山灰原
    bootstrap.register(ModBiomes.VOLCANIC_ASHLANDS, 
        ModBiomes.createVolcanicAshlands(placedFeatures, carvers));
});
```

---

## 🎨 自定義生物群系設計指南

### 🌈 **顏色配置建議**

```java
// 🌿 森林系生物群系
.waterColor(0x3F76E4)      // 清澈藍水
.skyColor(0x78A7FF)       // 明亮天空
.grassColorOverride(0x48B518) // 翠綠草地

// 🏜️ 沙漠系生物群系  
.waterColor(0xB8860B)      // 金色水
.skyColor(0xFFA500)       // 橙色天空
.grassColorOverride(0xD2B48C) // 沙色草

// ❄️ 冰雪系生物群系
.waterColor(0x4682B4)      // 冰藍水
.skyColor(0xE6E6FA)       // 淡紫天空
.grassColorOverride(0xE0FFFF) // 雪白草

// 🌋 火山系生物群系
.waterColor(0x8B4513)      // 褐色水
.skyColor(0xD2691E)       // 橙褐天空
.grassColorOverride(0x8B7D6B) // 枯黃草

// 🔮 魔法系生物群系
.waterColor(0x9932CC)      // 紫色水
.skyColor(0xDA70D6)       // 蘭花紫天空
.grassColorOverride(0xBA55D3) // 魔法紫草
```

### 🌡️ **氣候參數指南**

```java
// 🌿 常見生物群系（高權重 6-8）
.temperature(0.3F, 0.8F)
.humidity(0.3F, 0.8F)
.depth(0.0F, 0.3F)        // 地面層
.weirdness(-0.3F, 0.3F)   // 正常

// 🏔️ 稀有生物群系（低權重 2-4）
.temperature(-0.5F, 1.5F) // 極端溫度
.humidity(-0.8F, 1.2F)    // 極端濕度
.depth(0.3F, 0.8F)        // 高海拔
.weirdness(0.5F, 1.5F)    // 高怪異度

// 🌋 超稀有生物群系（權重 1-2）
.temperature(1.0F, 2.0F)  // 極熱
.humidity(-1.0F, 0.0F)    // 極乾
.depth(-0.3F, 0.8F)       // 多變地形
.weirdness(0.8F, 2.0F)    // 極高怪異度
```

### 🎮 **生物生成建議**

```java
// 🕊️ 和平生物群系
mobSpawnSettings.addSpawn(MobCategory.CREATURE,
    new MobSpawnSettings.SpawnerData(EntityType.COW, 8, 4, 4));
mobSpawnSettings.addSpawn(MobCategory.CREATURE,
    new MobSpawnSettings.SpawnerData(EntityType.SHEEP, 12, 4, 4));

// ⚔️ 危險生物群系
mobSpawnSettings.addSpawn(MobCategory.MONSTER,
    new MobSpawnSettings.SpawnerData(EntityType.ZOMBIE, 100, 4, 4));
mobSpawnSettings.addSpawn(MobCategory.MONSTER,
    new MobSpawnSettings.SpawnerData(EntityType.SKELETON, 100, 4, 4));

// 🔥 極端環境
mobSpawnSettings.addSpawn(MobCategory.MONSTER,
    new MobSpawnSettings.SpawnerData(EntityType.MAGMA_CUBE, 4, 2, 4));
mobSpawnSettings.addSpawn(MobCategory.MONSTER,
    new MobSpawnSettings.SpawnerData(EntityType.BLAZE, 2, 1, 2));

// ❄️ 寒冷環境
mobSpawnSettings.addSpawn(MobCategory.CREATURE,
    new MobSpawnSettings.SpawnerData(EntityType.POLAR_BEAR, 1, 1, 2));
```

---

## 🚀 快速添加模板

### 🎯 **複製這個模板快速添加新生物群系**

```java
// 🔸 1. ModBiomes.java - ResourceKey
public static final ResourceKey<Biome> YOUR_BIOME = ResourceKey.create(
    Registries.BIOME,
    ResourceLocation.fromNamespaceAndPath(KoniavacraftMod.MOD_ID, "your_biome")
);

// 🔸 2. ModBiomes.java - 創建方法
public static Biome createYourBiome(HolderGetter<PlacedFeature> placedFeatures,
                                    HolderGetter<ConfiguredWorldCarver<?>> carvers) {
    // TODO: 實現你的生物群系邏輯
    return new Biome.BiomeBuilder()
        .temperature(0.7f)
        .downfall(0.6f)
        .hasPrecipitation(true)
        .temperatureAdjustment(Biome.TemperatureModifier.NONE)
        .specialEffects(createYourBiomeEffects())
        .mobSpawnSettings(new MobSpawnSettings.Builder().build())
        .generationSettings(new BiomeGenerationSettings.Builder(placedFeatures, carvers).build())
        .build();
}

// 🔸 3. UniversalBiomeRegistration.java - 註冊
UniversalBiomeInjector.registerBiome(
    ModBiomes.YOUR_BIOME,
    UniversalBiomeInjector.ClimateConfig.builder()
        .temperature(0.5F, 0.8F)
        .humidity(0.4F, 0.7F)
        .continentalness(0.0F, 0.3F)
        .erosion(-0.2F, 0.2F)
        .depth(0.0F, 0.4F)
        .weirdness(-0.3F, 0.3F)
        .build(),
    5, // 權重
    "你的生物群系描述"
);

// 🔸 4. CompleteBiomeSurfaceSystem.java - 處理器
public static class YourBiomeProcessor implements BiomeProcessor {
    @Override
    public boolean canProcess(ServerLevel level, ChunkAccess chunk) {
        return BlockReplacementUtils.isBiomeFast(level, chunk, ModBiomes.YOUR_BIOME);
    }

    @Override
    public int processChunk(ServerLevel level, ChunkAccess chunk) {
        return BlockReplacementUtils.replace(level, chunk, ModBiomes.YOUR_BIOME,
            BlockReplacementUtils.rules(
                Blocks.GRASS_BLOCK, Blocks.MYCELIUM  // 示例替換
            )
        );
    }
}

// 🔸 5. CompleteBiomeSurfaceSystem.java - 註冊處理器
static {
    registerBiomeProcessor(ModBiomes.YOUR_BIOME, new YourBiomeProcessor());
}
```

---

## 🔧 進階技巧

### 💡 **條件替換範例**

```java
// 🌊 只在靠近水源時替換
BlockReplacementUtils.conditions(
    Blocks.SAND, BlockReplacementUtils.nearWater(3)
)

// 🎲 隨機替換（30%機率）
BlockReplacementUtils.conditions(
    Blocks.STONE, BlockReplacementUtils.chance(0.3f)
)

// 🏔️ 只在地表替換
BlockReplacementUtils.conditions(
    Blocks.DIRT, BlockReplacementUtils.SURFACE_ONLY
)

// 🌊 只在深層替換
BlockReplacementUtils.conditions(
    Blocks.STONE, BlockReplacementUtils.DEEP_UNDERGROUND
)
```

### 🎨 **組合條件**

```java
// 🌊 + 🎲 複合條件：靠近水源且有30%機率
BlockReplacementUtils.conditions(
    Blocks.SAND, 
    BlockReplacementUtils.nearWater(2).and(BlockReplacementUtils.chance(0.3f))
)
```

---

## 🎯 測試與除錯

### 🔍 **如何測試新生物群系**

1. **啟動遊戲查看日誌**：
   ```
   [INFO] 📝 註冊生物群系處理器: koniava:your_biome
   ```

2. **使用指令尋找**：
   ```
   /locatebiome koniava:your_biome
   ```

3. **觀察處理日誌**：
   ```
   [DEBUG] 📋 添加生物群系處理任務: your_biome at (12, 34)
   [DEBUG] ✅ 處理完成: your_biome at (12, 34), 替換42個方塊
   ```

### 🚨 **常見問題解決**

- **生物群系不生成** → 檢查氣候參數是否合理
- **地表不替換** → 確認處理器已註冊
- **遊戲崩潰** → 檢查方塊是否存在，import 是否正確
- **找不到生物群系** → 調整權重或氣候範圍

---

## 🎉 總結

現在你有了：
- ✅ **完整的添加流程** - 4步驟輕鬆搞定
- ✅ **實戰範例** - 火山灰原生物群系
- ✅ **設計指南** - 顏色、氣候、生物配置
- ✅ **快速模板** - 複製貼上即可使用
- ✅ **進階技巧** - 條件替換和組合邏輯

**有了這套優化過的系統，添加新生物群系就像搭積木一樣簡單！** 🧩✨

你想先試試創建哪個生物群系呢？