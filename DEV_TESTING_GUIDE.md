# 遊戲內自動化測試方案

## 🎯 目標

**一鍵測試所有機器功能**，不需要手動點擊每個 GUI。

---

## 🚀 方案 1：開發者測試方塊（最簡單）

### 實現方式

創建一個特殊的測試方塊，放置時自動：
1. 生成所有機器方塊
2. 填充測試物品
3. 模擬點擊 GUI 按鈕
4. 驗證結果
5. 在聊天窗口輸出測試報告

### 使用流程

```
1. 啟動遊戲
2. 給自己測試方塊：/give @s koniava:dev_test_block
3. 放置方塊 → 自動執行所有測試
4. 查看聊天窗口的測試結果
5. 破壞方塊清理
```

**預期時間**：30 秒（相比之前 10+ 分鐘）

---

## 🎮 方案 2：NeoForge GameTest 框架（官方支持）

### 優勢

- NeoForge 官方測試框架
- 可以在專用測試世界中運行
- 支持 GUI 測試、方塊交互、物品處理等
- 可以錄製測試結果

### 使用方式

```bash
# 運行所有 GameTest
./gradlew runGameTestServer

# 在遊戲內用指令運行
/test runall
/test run koniava.mana_generator_test
```

---

## ⌨️ 方案 3：快捷鍵調試模式（開發時使用）

### 添加開發快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| `F6` | 自動測試當前看著的機器 |
| `F7` | 重新加載所有機器配置 |
| `F8` | 輸出當前機器的調試信息 |
| `Ctrl+F6` | 運行完整測試套件 |

### 實現方式

```java
// ClientEventHandler.java
@SubscribeEvent
public static void onKeyInput(InputEvent.Key event) {
    if (event.getKey() == GLFW.GLFW_KEY_F6 && event.getAction() == GLFW.GLFW_PRESS) {
        // 獲取玩家看著的方塊
        // 如果是機器，自動執行測試
        runMachineTest();
    }
}
```

---

## 🔧 方案 4：聊天指令測試（最靈活）

### 實現測試指令

```
/koniava test all              - 測試所有機器
/koniava test mana_generator   - 測試魔力發電機
/koniava test gui              - 測試所有 GUI
/koniava test sync             - 測試數據同步
/koniava debug <machine>       - 輸出機器調試信息
```

### 測試輸出範例

```
[測試] 開始測試魔力發電機...
  ✓ BlockEntity 創建成功
  ✓ GUI 打開正常
  ✓ 模式切換：魔力 → 能量 → 魔力
  ✓ 數據同步正確
  ✓ 燃料消耗正確
[測試] 魔力發電機測試通過 (5/5)

[測試] 開始測試魔力注入機...
  ✓ BlockEntity 創建成功
  ✓ GUI 打開正常
  ✗ 進度條位置錯誤（預期 y=40，實際 y=38）
  ✓ 配方處理正確
[測試] 魔力注入機測試失敗 (3/4)
```

---

## 💡 推薦組合方案

### 日常開發流程

```
1. 修改代碼
2. ./gradlew build
3. 啟動遊戲
4. 按 F6 快速測試當前機器
   或
   /koniava test all 測試所有機器
5. 查看聊天窗口結果
6. 如果失敗，按 F8 查看詳細調試信息
```

**總時間**：1-2 分鐘（相比之前 10+ 分鐘）

---

## 📝 實現優先級

### 第一階段（1-2 小時）
- [ ] 創建基礎測試指令 `/koniava test`
- [ ] 實現機器狀態檢查
- [ ] 在聊天窗口輸出結果

### 第二階段（2-3 小時）
- [ ] 添加 GUI 自動化測試
- [ ] 實現按鈕點擊模擬
- [ ] 驗證同步數據

### 第三階段（可選）
- [ ] 添加快捷鍵支持
- [ ] 創建測試方塊
- [ ] 集成 GameTest 框架

---

## 🎯 我可以立即幫你實現

選擇你想要的方案：

1. **快速方案**：聊天指令測試（1-2 小時完成）
2. **完整方案**：測試方塊 + 指令 + 快捷鍵（3-4 小時完成）
3. **專業方案**：GameTest 框架集成（需要學習官方框架）

你想從哪個開始？我可以立即為你創建代碼。
