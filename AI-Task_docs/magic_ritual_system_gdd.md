# Koniavacraft 遊戲設計文檔：魔法儀式系統 (v1.2)

**文檔目的：** 本文檔旨在為「魔法儀式系統」提供一個從概念到實現的、極度詳盡的開發藍圖。它包含世界觀、核心玩法、玩家進程、具體配方、技術細節和未來擴展方向，作為開發團隊的權威指南。

---

## 1. 世界觀與定位 (Lore & Positioning)

在 Koniava 的世界中，「魔力 (Mana)」並非僅僅是一種能量，它是一種遍布萬物、具有原始意識的流動。凡人無法直接駕馭這種混沌的力量，但古代的先驅者們發現，透過特定的幾何結構和物質共鳴，可以「說服」魔力按照人的意志進行重組——這就是**魔法儀式**的起源。

**定位：**
*   **核心進程：** 儀式系統是玩家從「使用魔力」到「駕馭魔力」的轉捩點，是模組**中期到後期**的核心玩法。
*   **非自動化設計：** 與傳統科技模組的全自動化生產線不同，儀式強調的是「事件感」和「準備過程」。它應該感覺像是一場精心策劃的魔法實驗，而非一個可以被放置和遺忘的機器。
*   **高價值產出：** 儀式是獲取獨特合金、魔法裝置核心、人工製品乃至召喚生物的**唯一**途徑。

---

## 2. 核心組件詳解 (Core Components)

### 2.1. 方塊 (Blocks)

| 方塊名稱 | ID | 功能描述 | 獲取方式 |
| :--- | :--- | :--- | :--- |
| **儀式核心** | `koniava:ritual_core` | 儀式的中心，處理所有邏輯。是一個方塊實體。 | 合成 (中期配方) |
| **奧術基座** | `koniava:arcane_pedestal` | 放置祭品的平台。是一個方塊實體，用於渲染物品。 | 合成 (早期配方) |
| **魔力塔** | `koniava:mana_pylon` | 儀式的魔力接收器。可直接從相鄰的魔力導管網絡中抽取大量魔力。 | 合成 (中期配方) |
| **符文石** | `koniava:rune_stone_[type]` | 增強儀式的輔助方塊。共有四種基礎類型。 | 合成/儀式產出 |

### 2.2. 物品 (Items)

| 物品名稱 | ID | 功能描述 |
| :--- | :--- | :--- |
| **儀式師的粉筆** | `koniava:ritualist_chalk` | 用於在地面上繪製魔法陣圖案，定義儀式區域和類型。有耐久度。 |
| **共鳴水晶** | `koniava:resonant_crystal` | 啟動儀式的核心催化劑。消耗品。 |
| **虛空珍珠** | `koniava:void_pearl` | 用於高級儀式的催化劑，可能導致不穩定事件。 |

---

## 3. 玩法循環與進程 (Gameplay Loop & Progression)

### 3.1. 玩家進程

**第一階段：啟蒙 (Early-Mid Game)**
1.  玩家透過研究「娜拉系統」或找到古代文獻，解鎖「儀式師的粉筆」和「奧術基座」的配方。
2.  學習並進行第一個**初級儀式**，通常是將基礎材料轉化為初級魔法材料。
3.  此階段的儀式結構簡單，魔力消耗低，旨在教學。

**第二階段：擴展 (Mid Game)**
1.  玩家需要更高級的材料，驅使他們進行**中級儀式**。
2.  解鎖「魔力塔」，使得儀式可以從魔力網絡中抽取大量 Mana，擺脫了對玩家自身魔力儲備的依賴。
3.  解鎖「符文石」，開始學習優化儀式，降低成本，提高效率。

**第三階段：掌控 (Late Game)**
1.  玩家的目標轉向製作傳說級的物品或裝置。**高級儀式**成為常態。
2.  儀式結構變得複雜，需要多種符文石組合，魔力消耗巨大，需要玩家建立龐大的魔力生產設施。
3.  引入「虛空珍珠」作為催化劑，進行高風險的**禁忌儀式**。

**第四階段：超越 (End Game)**
1.  **終極儀式**用於創造改變遊戲規則的物品，或執行影響世界的效果（例如，永久改變區域天氣、創造一個小型專屬維度）。
2.  這些儀式是模組的終極目標和巨大的資源消耗點。

### 3.2. 儀式執行流程

1.  **繪製法陣：** 玩家使用「儀式師的粉筆」在平坦的地面上右鍵，繪製出一個特定圖案的魔法陣（例如 5x5, 7x7 的外框）。法陣決定了儀式的最大範圍和基礎類型。
2.  **搭建結構：** 在法陣內部，根據配方要求，放置「儀式核心」、「奧術基座」和「魔力塔」。
3.  **放置祭品：** 將祭品右鍵放置在對應的基座上。
4.  **啟動儀式：** 手持「催化劑」右鍵點擊「儀式核心」。
5.  **見證奇蹟：** 儀式開始，魔力被抽取，粒子效果飛舞，祭品逐一消耗。
6.  **收穫成果：** 儀式結束，在核心頂部拾取產物。

---

## 4. 符文石系統詳解 (Rune Stone System)

符文石為儀式提供了深度和可玩性。它們不是必需品，但熟練的儀式師會用它們來極大地優化流程。

| 符文石 | ID | 功能 | 協同效應 |
| :--- | :--- | :--- | :--- |
| **效率符文** | `koniava:rune_of_efficiency` | 每塊符文石使儀式總魔力消耗降低 8%。最多疊加 5 塊 (40%)。 | 與「穩定符文」相鄰時，額外降低 2% 消耗。 |
| **迅捷符文** | `koniava:rune_of_celerity` | 每塊符文石使儀式速度提升 10%。最多疊加 5 塊 (50%)。 | 放置在「魔力塔」正上方時，速度提升效果增至 15%。 |
| **穩定符文** | `koniava:rune_of_stability` | 每塊符文石顯著降低儀式失敗時的負面效果，並降低不穩定儀式的失敗機率。 | 4塊穩定符文組成對稱結構時，完全免疫普通失敗懲罰。 |
| **增幅符文** | `koniava:rune_of_augmentation` | 有機率使產物數量翻倍（對單一產物無效），或為產物附加一個隨機的良性 NBT 標籤（如微弱的附魔）。 | 儀式在雷雨天進行時，增幅符文的效果必定觸發。 |

---

## 5. 儀式配方詳單 (Detailed Ritual Recipes)

### 5.1. 初級儀式 (Tier 1)

*   **儀式：奧術合金的誕生**
    *   **定位：** 模組最基礎的魔法金屬，用於製作初級工具和裝置。
    *   **結構：** 1x 核心, 4x 基座 (圍繞核心)
    *   **祭品：** 4x 鐵錠, 4x 青金石
    *   **催化劑：** 共鳴水晶
    *   **魔力消耗：** 5,000 Mana
    *   **產物：** 4x `koniava:arcane_alloy_ingot`

*   **儀式：活化木材**
    *   **定位：** 用於裝飾和製作初級魔法棒的材料。
    *   **結構：** 1x 核心, 2x 基座
    *   **祭品：** 16x 任意原木, 2x 綠寶石
    *   **催化劑：** 共鳴水晶
    *   **魔力消耗：** 2,000 Mana
    *   **產物：** 16x `koniava:livingwood_log`

### 5.2. 中級儀式 (Tier 2)

*   **儀式：魔力透鏡的精煉**
    *   **定位：** 中級機械和光學裝置的核心組件。
    *   **結構：** 1x 核心, 4x 基座 (在四個角落), 1x 魔力塔 (任意位置)
    *   **祭品：** 4x 奧術合金錠, 4x 紫水晶碎片, 1x 玻璃塊
    *   **催化劑：** 共鳴水晶
    *   **魔力消耗：** 25,000 Mana
    *   **產物：** 1x `koniava:mana_lens`

*   **儀式：效率符文的刻印**
    *   **定位：** 第一塊符文石的製作，引導玩家進入優化階段。
    *   **結構：** 1x 核心, 1x 基座
    *   **祭品：** 1x 黑曜石, 4x 奧術合金錠, 4x 紅石粉
    *   **催化劑：** 共鳴水晶
    *   **魔力消耗：** 50,000 Mana
    *   **產物：** 1x `koniava:rune_of_efficiency`

### 5.3. 高級儀式 (Tier 3)

*   **儀式：星辰金屬的鍛造**
    *   **定位：** 頂級工具和盔甲的材料，具有自我修復或發光等特性。
    *   **結構：** 複雜的星型結構，需要 8x 基座, 2x 魔力塔, 4x 迅捷符文。
    *   **祭品：** 1x 下界之星, 4x 下界合金錠, 8x `koniava:mana_lens`
    *   **催化劑：** 共鳴水晶
    *   **魔力消耗：** 500,000 Mana
    *   **產物：** 2x `koniava:starmetal_ingot`

*   **儀式：禁忌 - 虛空珍珠的裂解**
    *   **定位：** 高風險地獲取用於禁忌儀式的催化劑。
    *   **結構：** 任意
    *   **祭品：** 1x 末影珍珠, 4x 紫頌果
    *   **催化劑：** 共鳴水晶
    *   **魔力消耗：** 100,000 Mana
    *   **不穩定性：** 高。有 30% 機率失敗。
    *   **產物：** 1x `koniava:void_pearl`
    *   **失敗後果：** 召喚 2-3 隻末影蟎，並在儀式中心產生一個短暫的凋零效果區域。

### 5.4. 終極儀式 (Tier 4)

*   **儀式：世界之心**
    *   **定位：** 一個能緩慢地、被動地為周圍區塊提供微量魔力，並促進作物生長的奇蹟方塊。
    *   **結構：** 需要所有四種符文石，且佈局極度對稱和複雜。
    *   **祭品：** 1x 龍蛋, 1x 海之眷顧, 1x `koniava:starmetal_block`, 4x 鑽石塊
    *   **催化劑：** 虛空珍珠
    *   **魔力消耗：** 10,000,000 Mana
    *   **產物：** 1x `koniava:heart_of_the_world`

---

## 6. 技術實現細節 (Technical Implementation)

*   **結構檢測：** 儀式啟動時，從核心方塊開始，迭代檢查周圍的方塊是否符合配方定義的 `Map<BlockPos, Block>`。
*   **配方系統：** 使用 Minecraft 的 `RecipeManager` 和自定義的 `RecipeType<RitualRecipe>`。`RitualRecipe` 類應包含祭品列表、催化劑、結構圖、魔力消耗、儀式時長等所有信息。
*   **渲染：**
    *   **魔法陣：** 透過 `BlockEntityRenderer` 在 `RitualCore` 的位置，使用 GLSL 著色器直接在地面上繪製一個平面，並應用 `magic_circle` 紋理和動畫。
    *   **粒子束：** 在 `BlockEntityRenderer` 的 `render()` 方法中，根據儀式進度，動態計算粒子束的起點（基座）和終點（核心），並生成粒子。
*   **JEI/EMI 整合：**
    *   創建一個自定義的 `IRecipeCategory`。
    *   配方展示頁面應包含：產物、魔力消耗、催化劑、祭品列表。
    *   提供一個按鈕或分頁，用於顯示一個層疊的、可視化的結構圖，指導玩家如何搭建。

---

## 7. 未來擴展方向 (Future Expansions)

*   **環境因素：** 特定儀式需要在特定生物群系、天氣（雷雨）、時間（午夜）或月相下才能進行。
*   **多玩家儀式：** 需要多名玩家同時在不同位置進行操作的超大型儀式。
*   **移動儀式：** 可以在類似飛艇的載具上進行的儀式。
*   **儀式失敗的多樣化：** 除了爆炸，還可能導致區域性的天氣變化、時空扭曲（給予玩家緩慢效果）、或將祭品轉化為「廢料」。
